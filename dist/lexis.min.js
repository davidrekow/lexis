(function () {function d(){this.b="PENDING";this.c=[];this.a=null}d.prototype.fulfill=function(a,b){var c;"PENDING"!==this.b&&(a=!1,b=Error("Can't fulfill already-fulfilled future with value "+a+"."));if(a instanceof d&&"FULFILLED"!==a.b)return a.then(this);c=this.c;setTimeout(c.forEach.bind(c,function(c){c instanceof d?c.fulfill(a,b):c(a,b)}),0);this.c=null;this.b=b?"FAILED":"FULFILLED";this.a=[a,b];return this};
d.prototype.then=function(a){function b(b,p){var q;if(a instanceof d)a.then(function(a,b){c.fulfill(a,b)}),a.fulfill(b,p);else{try{q=a(b,p)}catch(t){return c.fulfill(!1,t)}c.fulfill(q)}}var c=new d;this.a?b.apply(null,this.a):this.c.push(b);return c};function e(a,b){this.message=a||"";this.name="LexError";this.lineno="number"===typeof b?b:1;Error.captureStackTrace(this,this.constructor)}e.prototype.toString=function(){return this.name+": "+this.message};var f={n:/(?:\r\n|\n|\r)/,q:/\\/g,m:/^RE::(.*)$/,p:"/{}()[]^$,.+?*|".split(""),escape:function(a){return a.split("").map(function(a){return~f.p.indexOf(a)?"\\"+a:a}).join("")}};function g(a,b,c){this.type=a;this.value=b;this.lineno="number"===typeof c?c:1}g.prototype.toString=function(){return this.type+'<"'+this.value+'">:'+this.lineno};var h=f;function l(a){this.a={o:[]};a&&this.define(a)}l.prototype.define=function(a){var b,c,k;for(b in a)a.hasOwnProperty(b)&&(c=a[b],k={source:c,type:b},h.m.test(c)?(k.l=new RegExp(c.slice(4)),k.k=!0,c="RE"):(k.l=new RegExp(h.escape(c)),k.k=!1,c=c.charAt(0)),this.a[c]||(this.a[c]=[]),this.a[c].push(k))};l.prototype.getRules=function(a){return a?(this.a[a.charAt(0)]||[]).concat(this.a.o):[]};
l.prototype.filter=function(a,b){var c=this;return(a||this.getRules(b)).filter(function(a){return a.k?!!c.match([a],b).length:-1<a.source.indexOf(b)})};l.prototype.match=function(a,b){return(a||this.getRules(b)).filter(function(a){return(a=a.l.exec(b))&&a.length&&a[0].length===b.length})};var m=f;function n(a,b){this.error=this.source=this.lexicon=null;this.tokens=[];this.h=[];this.j=[];this.f=this.b=null;this.d=[];this.e=[];this.g=[];this.c=0;this.a=null;this.i=new d;a&&this.setLexicon(a);b&&this.setSource(b)}n.prototype.reset=function(a){n.call(this,!0===a?this.lexicon:void 0);return this};
n.prototype.setSource=function(a){if("number"!==typeof a.length||"function"!==typeof a.slice)return this.error=new e("Lexer.setSource() expects a string or char array source."),r(this);this.source=a;this.a=this.c=1;"string"===typeof a?(this.e=a.split(m.n),this.g=this.e.shift().split("")):(this.e=[],this.g=a.slice())};
n.prototype.setLexicon=function(a){if(a){if(!(a instanceof l))try{a=new l(a)}catch(b){this.error=b,r(this)}this.lexicon=a}else this.error=new e("Lexer.setLexicon() expects an object or instance of Lexicon."),r(this)};
n.prototype.lex=function(a){var b=this,c;("string"===typeof a||Array.isArray(a))&&this.setSource(a);this.source&&this.e&&this.g||(this.error=new e("Lexer.lex() cannot be called before source and lexicon are set."),this.a=-1);a=this.b||"";switch(this.a){case -1:return r(this),this.i;case 0:return this.tokens.push(new g("EOF","",this.c)),this.i.fulfill(this.tokens),this.i;case 1:c=this.f||this.g.shift();if(!c){this.e.length?(this.g=this.e.shift().split(""),this.c+=1):this.a=0;break}this.f=c;this.b=
a+c;this.h=this.lexicon.getRules(c);this.a=this.h.length?2:-1;-1===this.a&&(this.error=new e("No rule matched: "+c,this.c));break;case 2:this.j=this.lexicon.match(this.h,this.b);this.h=this.lexicon.filter(this.h,this.b);this.d=this.d||[];this.a=this.j.length?6:this.h.length?3:this.d.length?4:-1;-1===this.a&&(this.error=new e("Unrecognized token: "+a,this.c));break;case 3:(c=this.g.shift())?(this.f=c,this.b=this.b+this.f,this.a=2):(this.f=null,this.a=this.j.length?6:this.d.length?5:-1);-1===this.a&&
(this.error=new e("Unexpected end of input: "+a,this.c));break;case 4:this.tokens.push(new g(this.d[0].type,this.b.slice(0,-1),this.c));this.f=this.b.slice(-1);this.a=7;break;case 5:this.tokens.push(new g(this.d[0].type,this.b,this.c));this.a=7;break;case 6:this.d=this.j;this.j=[];this.a=3;break;case 7:this.d=[];this.b="";this.a=1;break;default:this.error=new e("Invalid Lexer state: "+this.a,this.c),this.a=-1}setTimeout(function(){b.lex()},0);return this.i};function r(a){a.i.fulfill(!1,a.error)};var s={};function u(a){return new n(a)}u.Future=d;u.Token=g;u.LexError=e;u.Lexicon=l;u.Lexer=n;u({});"undefined"!==typeof window&&(window.lexis=u);"object"===typeof module&&"object"===typeof s&&(s=u);"function"===typeof define&&define("lexis",u);}).call(this);
